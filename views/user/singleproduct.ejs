<%- include('../partials/user/header') %>

<style>
  .qty-btn_area {
    margin-top: 15px;
  }

  .qty-btn_area ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    gap: 10px;
  }

  .qty-btn_area ul li {
    display: inline-block;
  }

  .qty-cart_btn {
    background: rgb(51, 51, 51);
    color: #ffffff;
    font-size: 14px;
    font-weight: 500;
    height: 45px;
    line-height: 45px;
    padding: 0 25px;
    text-align: center;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s ease-in-out;
  }

  .qty-cart_btn:hover {
    background: #cda557;
    color: #ffffff;
  }

  .qty-wishlist_btn {
    background: #ffffff;
    border: 1px solid #ddd;
    color: #333333;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    height: 45px;
    width: 45px;
    border-radius: 3px;
    transition: all 0.3s ease-in-out;
    text-decoration: none;
  }

  .qty-wishlist_btn:hover {
    border-color: #cda557;
    border-width: 2px;
    color: #ffffff;
  }

  .qty-wishlist_btn i {
    display: flex;
    align-items: center;
    justify-content: center;
  }
</style>

<!-- Begin Hiraola's Breadcrumb Area -->
<div class="breadcrumb-area">
  <div class="container">
    <div class="breadcrumb-content">
      <h2>Single Product Type</h2>
      <ul>
        <li><a href="/home">Home</a></li>
        <li class="active">Single Product</li>
      </ul>
    </div>
  </div>
</div>
<!-- Hiraola's Breadcrumb Area End Here -->

<!-- Begin Hiraola's Single Product Area -->
<div class="sp-area">
  <div class="container">
    <div class="sp-nav">
      <div class="row">
        <div class="col-lg-5 col-md-5">
          <div class="sp-img_area">
            <div class="zoompro-border">
              <img
                class="zoompro"
                src="/<%= product.productImage[0] %>"
                data-zoom-image="/<%= product.productImage[0] %>"
                alt="<%= product.productName %> Image"
              />
            </div>
            <div id="gallery" class="sp-img_slider">
              <% product.productImage.forEach((image, index) => { %>
              <a
                class="<%= index === 0 ? 'active' : '' %>"
                data-image="/<%= image %>"
                data-zoom-image="/<%= image %>"
              >
                <img
                  src="/<%= image %>"
                  alt="<%= product.productName %>'s Image"
                />
              </a>
              <% }); %>
            </div>
          </div>
        </div>
        <div class="col-lg-7 col-md-7">
          <div class="sp-content">
            <div class="sp-heading">
              <h5><a href="#"><%= product.productName %></a></h5>
            </div>
            <div class="rating-box">
              <ul>
                <li><i class="fa fa-star-of-david"></i></li>
                <li><i class="fa fa-star-of-david"></i></li>
                <li><i class="fa fa-star-of-david"></i></li>
                <li><i class="fa fa-star-of-david"></i></li>
                <li class="silver-color">
                  <i class="fa fa-star-of-david"></i>
                </li>
              </ul>
            </div>
            <!-- <div class="sp-essential_stuff">
                                    <ul>
                                        <li>EX Tax: <a href="javascript:void(0)"><span>£453.35</span></a></li>
                                        <li>Brands <a href="javascript:void(0)">Buxton</a></li>
                                        <li>Product Code: <a href="javascript:void(0)">Product 16</a></li>
                                        <li>Reward Points: <a href="javascript:void(0)">600</a></li>
                                        <li>Availability: <a href="javascript:void(0)">In Stock</a></li>
                                    </ul>
                                </div> -->
            <!-- <div class="product-size_box">
                                    <span>Size</span>
                                    <select class="myniceselect nice-select">
                                        <option value="1">S</option>
                                        <option value="2">M</option>
                                        <option value="3">L</option>
                                        <option value="4">XL</option>
                                    </select>
                                </div> -->

                                <a href="#">
                                  <% if (product.totalStock == 0) { %>
                                    Out Of Stock
                                  <% } else { %>
                                   Availability : <%= product.totalStock %> Item Available
                                  <% } %>
                                </a>

            <div class="quantity">
              <label>Quantity</label>

              
              <div class="cart-plus-minus">
                <input class="cart-plus-minus-box" value="1" type="text" />
                <div class="dec qtybutton">
                  <i class="fa fa-angle-down"></i>
                </div>
                <div class="inc qtybutton"><i class="fa fa-angle-up"></i></div>
              </div>
            </div>


            
            <div class="qty-btn_area">
              <ul>
                <li>
                  <button
                    type="button"
                    class="qty-cart_btn"
                    data-bs-toggle="tooltip"
                    title="Add To Cart"
                    onclick="addToCart('<%= product._id %>')"
                  >
                    Add To Cart
                  </button>
                </li>
                <li>
                  <a
                    class="qty-wishlist_btn"
                    href="/wishlist"
                    data-bs-toggle="tooltip"
                    title="Add To Wishlist"
                    ><i class="ion-android-favorite-outline"></i
                  ></a>
                </li>
              </ul>
            </div>

            <!-- <div class="hiraola-tag-line">
                                    <h6>Tags:</h6>
                                    <a href="javascript:void(0)">Ring</a>,
                                    <a href="javascript:void(0)">Necklaces</a>,
                                    <a href="javascript:void(0)">Braid</a>
                                </div> -->
            <!-- <div class="hiraola-social_link">
                                    <ul>
                                        <li class="facebook">
                                            <a href="https://www.facebook.com/" data-bs-toggle="tooltip" target="_blank" title="Facebook">
                                                <i class="fab fa-facebook"></i>
                                            </a>
                                        </li>
                                        <li class="twitter">
                                            <a href="https://twitter.com/" data-bs-toggle="tooltip" target="_blank" title="Twitter">
                                                <i class="fab fa-twitter-square"></i>
                                            </a>
                                        </li>
                                        <li class="youtube">
                                            <a href="https://www.youtube.com/" data-bs-toggle="tooltip" target="_blank" title="Youtube">
                                                <i class="fab fa-youtube"></i>
                                            </a>
                                        </li>
                                        <li class="google-plus">
                                            <a href="https://www.plus.google.com/discover" data-bs-toggle="tooltip" target="_blank" title="Google Plus">
                                                <i class="fab fa-google-plus"></i>
                                            </a>
                                        </li>
                                        <li class="instagram">
                                            <a href="https://rss.com/" data-bs-toggle="tooltip" target="_blank" title="Instagram">
                                                <i class="fab fa-instagram"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </div> -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Hiraola's Single Product Area End Here -->

<!-- Begin Hiraola's Single Product Tab Area -->
<div class="hiraola-product-tab_area-2 sp-product-tab_area">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="sp-product-tab_nav">
          <div class="product-tab">
            <ul class="nav product-menu">
              <li>
                <a class="active" data-bs-toggle="tab" href="#description"
                  ><span>Description</span></a
                >
              </li>
              <li>
                <a data-bs-toggle="tab" href="#reviews"
                  ><span>Reviews (1)</span></a
                >
              </li>
            </ul>
          </div>
          <div class="tab-content hiraola-tab_content">
            <div id="description" class="tab-pane active show" role="tabpanel">
              <div class="product-description">
                <ul>
                  <li><%= product.description %></li>
                </ul>
              </div>
            </div>
            <div id="reviews" class="tab-pane" role="tabpanel">
              <div class="tab-pane active" id="tab-review">
                <form class="form-horizontal" id="form-review">
                  <div id="review">
                    <table class="table table-striped table-bordered">
                      <tbody>
                        <tr>
                          <td style="width: 50%"><strong>Customer</strong></td>
                          <td class="text-right">25/04/2022</td>
                        </tr>
                        <tr>
                          <td colspan="2">
                            <p>Good product! Thank you very much</p>
                            <div class="rating-box">
                              <ul>
                                <li><i class="fa fa-star-of-david"></i></li>
                                <li><i class="fa fa-star-of-david"></i></li>
                                <li><i class="fa fa-star-of-david"></i></li>
                                <li><i class="fa fa-star-of-david"></i></li>
                                <li><i class="fa fa-star-of-david"></i></li>
                              </ul>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <h2>Write a review</h2>
                  <div class="form-group required">
                    <div class="col-sm-12 p-0">
                      <label>Your Email <span class="required">*</span></label>
                      <input
                        class="review-input"
                        type="email"
                        name="con_email"
                        id="con_email"
                        required
                      />
                    </div>
                  </div>
                  <div class="form-group required second-child">
                    <div class="col-sm-12 p-0">
                      <label class="control-label">Share your opinion</label>
                      <textarea
                        class="review-textarea"
                        name="con_message"
                        id="con_message"
                      ></textarea>
                      <div class="help-block">
                        <span class="text-danger">Note:</span> HTML is not
                        translated!
                      </div>
                    </div>
                  </div>
                  <div class="form-group last-child required">
                    <div class="col-sm-12 p-0">
                      <div class="your-opinion">
                        <label>Your Rating</label>
                        <span>
                          <select class="star-rating">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                          </select>
                        </span>
                      </div>
                    </div>
                    <div class="hiraola-btn-ps_right">
                      <a
                        href="javascript:void(0)"
                        class="hiraola-btn hiraola-btn_dark"
                        >Continue</a
                      >
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Begin Hiraola's Product Area Two -->
<div class="hiraola-product_area hiraola-product_area-2 section-space_add">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="hiraola-section_title">
          <h4>Related Products</h4>
        </div>
      </div>
      <div class="col-lg-12">
        <div class="hiraola-product_slider-3">
          <% relatedProduct.forEach(function(related) { %>
          <div class="slide-item">
            <div class="single_product">
              <div class="product-img">
                <a href="/singleproduct/<%= related._id %>">
                  <img
                    class="primary-img"
                    src="/<%= related.productImage[0] %>"
                    alt="<%= related.productName %>"
                  />
                  <img
                    class="secondary-img"
                    src="/<%= related.productImage[1] || related.productImage[0] %>"
                    alt="<%= related.productName %>"
                  />
                </a>
                <div class="add-actions">
                  <ul>
                    <li>
                      <a
                        class="hiraola-add_cart"
                        href="/cart"
                        data-bs-toggle="tooltip"
                        data-placement="top"
                        title="Add To Cart"
                        ><i class="ion-bag"></i
                      ></a>
                    </li>

                    <li
                      class="quick-view-btn"
                      data-bs-toggle="modal"
                      data-bs-target="#exampleModalCenter"
                    >
                      <a
                        href="javascript:void(0)"
                        data-bs-toggle="tooltip"
                        data-placement="top"
                        title="Quick View"
                        ><i class="ion-eye"></i
                      ></a>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="hiraola-product_content">
                <div class="product-desc_info">
                  <h6>
                    <a class="product-name" href="/product/<%= related._id %>"
                      ><%= related.productName %></a
                    >
                  </h6>
                  <div class="price-box">
                    <span class="new-price">₹<%= related.price %></span>
                  </div>
                  <div class="additional-add_action">
                    <ul>
                      <li>
                        <a
                          class="hiraola-add_compare"
                          href="wishlist.html"
                          data-bs-toggle="tooltip"
                          data-placement="top"
                          title="Add To Wishlist"
                          ><i class="ion-android-favorite-outline"></i
                        ></a>
                      </li>
                    </ul>
                  </div>
                  <div class="rating-box">
                    <ul>
                      <li><i class="fa fa-star-of-david"></i></li>
                      <li><i class="fa fa-star-of-david"></i></li>
                      <li><i class="fa fa-star-of-david"></i></li>
                      <li><i class="fa fa-star-of-david"></i></li>
                      <li class="silver-color">
                        <i class="fa fa-star-of-david"></i>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Hiraola's Slide Item Area End Here -->
          <% }); %>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Hiraola's Product Area Two End Here -->

<%- include('../partials/user/footer') %>

<!-- Replace your existing zoom script with this -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/elevatezoom/2.2.3/jquery.elevatezoom.min.js"></script>

<script>
  $(document).ready(function () {
    // Initialize zoom on the main product image
    $(".zoompro").elevateZoom({
      gallery: "gallery",
      galleryActiveClass: "active",
      zoomType: "inner",
      cursor: "crosshair",
      zoomWindowFadeIn: 500,
      zoomWindowFadeOut: 500,
      lensFadeIn: 500,
      lensFadeOut: 500,
      scrollZoom: true,
    });

    // Handle gallery thumbnail clicks
    $("#gallery a").on("click", function (e) {
      e.preventDefault();

      // Get image URLs
      var newImage = $(this).data("image");
      var newZoomImage = $(this).data("zoom-image");

      // Update the main image and reinitialize zoom
      $(".zoompro").attr("src", newImage).attr("data-zoom-image", newZoomImage);

      // Destroy previous zoom and reinitialize
      $(".zoompro").elevateZoom({
        gallery: "gallery",
        galleryActiveClass: "active",
        zoomType: "inner",
        cursor: "crosshair",
        zoomWindowFadeIn: 500,
        zoomWindowFadeOut: 500,
        lensFadeIn: 500,
        lensFadeOut: 500,
        scrollZoom: true,
      });
    });
  });

  async function addToCart(productId) {
    console.log("entering to the addtocart method");
    const quantity = document.querySelector(".cart-plus-minus-box").value;
    console.log("quantity:", quantity);

    try {
      const response = await fetch("/addtocart/" + productId, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          productId: productId,
          quantity: quantity,
        }),
      });

      const data = await response.json();

      if (response.ok) {
        // Success message
        Swal.fire({
          icon: "success",
          title: "Success!",
          text: "Product added to cart successfully!",
          showConfirmButton: false,
          timer: 1500,
        });

        if (data.cartCount) {
          const cartCountElement = document.querySelector(".cart-count");
          if (cartCountElement) {
            cartCountElement.textContent = data.cartCount;
          }
        }
      } else {
        // Error message
        Swal.fire({
          icon: "error",
          title: "Oops...",
          text: data.message || "Failed to add product to cart",
        });
      }
    } catch (error) {
      console.error("Error:", error);
      Swal.fire({
          icon: "warning",
          title: "Please Login",
          text: "Please login to continue",
          showCancelButton: true,
          confirmButtonText: "Login",
          cancelButtonText: "Cancel",
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
        }).then((result) => {
          if (result.isConfirmed) {
            window.location.href = "/login"; 
          }
        });
    }
  }

  document.addEventListener("DOMContentLoaded", function () {
    const quantityInput = document.querySelector(".cart-plus-minus-box");
    document
      .querySelector(".inc.qtybutton")
      .addEventListener("click", function () {
        quantityInput.value = parseInt(quantityInput.value) + 1;
      });

    document
      .querySelector(".dec.qtybutton")
      .addEventListener("click", function () {
        if (parseInt(quantityInput.value) > 1) {
          quantityInput.value = parseInt(quantityInput.value) - 1;
        }
      });
  });
</script>
