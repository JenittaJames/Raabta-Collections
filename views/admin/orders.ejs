<%- include('../partials/admin/header') %>

<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h1>Orders List</h1>
            <p class="lead">Orders Management</p>
        </div>
    </div>

    <!-- Search Container -->
    <div class="row mb-4">
        <div class="col-12">
            <form action="/admin/orders" method="GET">
                <div class="input-group">
                    <input 
                        type="text" 
                        name="query" 
                        class="form-control" 
                        placeholder="Search by order ID, customer name or status..." 
                        value="<%= locals.searchQuery || '' %>"
                    >
                    <button class="btn btn-dark" type="submit">Search</button>
                    <% if (locals.searchQuery) { %>
                        <a href="/admin/orders" class="btn btn-outline-secondary">Clear</a>
                    <% } %>
                </div>
            </form>
        </div>
    </div>

    <div class="row mt-3">
        <% if (order.length > 0) { %>
            <div class="col-12">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>SL.No</th>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Order Status</th>
                                <th>Payment Status</th>
                                <th>Return Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% order.forEach((order, index) => { %>
                                <tr data-order-id="<%= order.id %>">
                                    <td><%= index + 1 %></td>
                                    <td><%= order.orderNumber %></td>
                                    <td><%= order.userName %></td>
                                    <td><%= new Date(order.orderDate).toLocaleDateString() %></td>
                                    <td>₹<%= order.finalAmount ? order.finalAmount.toFixed(2) : '0.00' %></td>
                                    <td>
                                        <span class="badge bg-<%= order.status === 'Delivered' ? 'success' : order.status === 'Cancelled' ? 'danger' : order.status === 'Returned' ? 'info' : 'warning' %>">
                                            <%= order.status %>
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-<%= order.paymentStatus === 'Paid' ? 'success' : order.paymentStatus === 'failed' ? 'danger' : order.paymentStatus === 'refunded' || order.paymentStatus === 'partially-refunded' ? 'info' : 'warning' %>">
                                            <%= order.paymentStatus %>
                                        </span>
                                    </td>
                                    <td>
                                        <% if (order.hasReturnRequest) { %>
                                            <span class="badge bg-warning">Return Requested</span>
                                        <% } else if (order.hasReturnApproved) { %>
                                            <span class="badge bg-success">Return Approved</span>
                                        <% } else if (order.hasReturnRejected) { %>
                                            <span class="badge bg-danger">Return Rejected</span>
                                        <% } else { %>
                                            <span class="text-muted">None</span>
                                        <% } %>
                                    </td>
                                    <td>
                                        <a href="/admin/orders/<%= order.id %>" class="btn btn-sm" style="background-color: black; color: white;">
                                            View
                                        </a>
                                    </td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
        <% } else { %>
            <div class="col-12">
                <div class="alert alert-info">
                    No Orders found
                </div>
            </div>
        <% } %>
    </div>

    <div class="row mt-3">
        <div class="col-12">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    <% if (currentPage > 1) { %>
                        <li class="page-item">
                            <a class="page-link" href="?page=<%= currentPage - 1 %><%= locals.searchQuery ? '&query=' + searchQuery : '' %>" aria-label="Previous">
                                <span aria-hidden="true">←</span>
                            </a>
                        </li>
                    <% } %>
                
                    <% for (let i = 1; i <= totalPages; i++) { %>
                        <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                            <a class="page-link" href="?page=<%= i %><%= locals.searchQuery ? '&query=' + searchQuery : '' %>"><%= i %></a>
                        </li>
                    <% } %>
                
                    <% if (currentPage < totalPages) { %>
                        <li class="page-item">
                            <a class="page-link" href="?page=<%= currentPage + 1 %><%= locals.searchQuery ? '&query=' + searchQuery : '' %>" aria-label="Next">
                                <span aria-hidden="true">→</span>
                            </a>
                        </li>
                    <% } %>
                </ul>
            </nav>
        </div>
    </div>
</div>

<%- include('../partials/admin/footer') %>